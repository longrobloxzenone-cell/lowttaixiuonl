<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Online - Hosted on GitHub</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <style>
        /* GIAO DI·ªÜN MOBILE CASINO */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            background: radial-gradient(circle, #8b0000 0%, #000 100%);
            color: #fff; font-family: 'Segoe UI', sans-serif;
            margin: 0; padding: 0; overflow-x: hidden;
        }
        #loginPanel, #gamePanel { width: 100%; max-width: 500px; margin: 0 auto; padding: 20px; }
        h2 { font-size: 1.8rem; text-transform: uppercase; margin-bottom: 20px; color: #ffd700; text-align: center; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 10px; border: 1px solid #444; background: #1a1a1a; color: #fff; font-size: 16px; }
        button { cursor: pointer; border-radius: 10px; border: none; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.96); }

        /* Ti·ªÅn & X√∫c x·∫Øc */
        #money { font-size: 40px; color: #4caf50; font-weight: bold; text-align: center; margin: 15px 0; }
        #diceArea { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .dice { width: 75px; height: 75px; background: #fff; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        /* Chip c∆∞·ª£c */
        #chipArea { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 15px 0; }
        .chip { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #fff; border: 3px solid rgba(255,255,255,0.8); font-size: 12px; }
        .chip.selected { border: 4px solid #ffd700; transform: scale(1.2); box-shadow: 0 0 15px #ffd700; }
        .chip.disabled { opacity: 0.2; filter: grayscale(1); pointer-events: none; }

        .chip[data-value="1000"] { background: #4caf50; }
        .chip[data-value="1000000"] { background: #2196f3; }
        .chip[data-value="5000000"] { background: #8e24aa; }
        .chip[data-value="10000000"] { background: #b71c1c; }

        .action-btn { width: 48%; padding: 18px; font-size: 20px; color: #fff; margin-bottom: 15px; }
        #btnRoll { width: 100%; padding: 20px; font-size: 22px; background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; margin-top: 10px; }

        /* Admin Panel */
        #adminPanel { margin-top: 40px; padding: 20px; background: rgba(0,0,0,0.9); border: 2px solid #ffd700; border-radius: 20px; display: none; }
        .admin-section { border-bottom: 1px solid #333; padding: 15px 0; }
        .user-card { background: #262626; padding: 12px; margin: 8px 0; border-radius: 10px; font-size: 14px; border-left: 5px solid #ffd700; }
        .user-actions { display: flex; gap: 8px; margin-top: 10px; }
        .user-actions button { padding: 8px; font-size: 12px; flex: 1; color: #fff; }

        .lock-banner { background: #ff0000; color: #fff; padding: 12px; font-weight: bold; border-radius: 8px; margin-bottom: 15px; display: none; text-align: center; }
    </style>
</head>
<body>

<div id="loginPanel">
    <h2>CASINO ONLINE</h2>
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
    <button onclick="login()" style="width:100%; padding:16px; background:#ffd700; color:#000; font-size:18px;">ƒêƒÇNG NH·∫¨P</button>
    <button onclick="register()" style="width:100%; padding:12px; background:transparent; color:#888; margin-top:15px; font-size:14px;">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</button>
</div>

<div id="gamePanel" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <span id="displayUserName" style="color: #ffd700; font-weight:bold; font-size:16px;">üë§ T·∫£i d·ªØ li·ªáu...</span>
        <button onclick="logout()" style="background:#333; color:#fff; padding:6px 12px; font-size:12px;">ƒêƒÉng xu·∫•t</button>
    </div>
    
    <div id="money">0</div>
    <div id="lockBanner" class="lock-banner">‚ö†Ô∏è M√ÅY ƒêANG B·∫¢O TR√å ‚ö†Ô∏è</div>

    <div id="diceArea">
        <div id="dice1" class="dice">üé≤</div>
        <div id="dice2" class="dice">üé≤</div>
        <div id="dice3" class="dice">üé≤</div>
    </div>
    
    <div id="resultText" style="text-align:center; font-weight:bold; height: 35px; color: #ffd700; font-size: 18px;">Ch√∫c b·∫°n may m·∫Øn!</div>

    <div id="chipArea">
        <div class="chip" data-value="1000">1K</div>
        <div class="chip" data-value="1000000">1M</div>
        <div class="chip" data-value="5000000">5M</div>
        <div class="chip" data-value="10000000">10M</div>
    </div>

    <div id="selectedBet" style="text-align:center; margin:15px; font-size:14px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; color: #aaa;">
        M·ª©c c∆∞·ª£c: 0 | C·ª≠a ch·ªçn: -
    </div>
    
    <div style="display:flex; justify-content: space-between;">
        <button onclick="chooseBet('T√†i')" class="action-btn" style="background: linear-gradient(to bottom, #ff5722, #bf360c);">T√ÄI</button>
        <button onclick="chooseBet('X·ªâu')" class="action-btn" style="background: linear-gradient(to bottom, #2196f3, #0d47a1);">X·ªàU</button>
    </div>
    <button id="btnRoll" onclick="rollDice()">QUAY TH∆Ø·ªûNG</button>

    <div id="adminPanel">
        <h3 style="color:#ffd700; text-align:center; margin:0 0 15px 0;">QU·∫¢N TR·ªä VI√äN</h3>
        <div class="admin-section">
            <strong>Tr·∫°ng th√°i m√°y:</strong> <span id="lockStatusDisplay" style="color:lime">M·ªû</span><br>
            <button onclick="adminToggleLock(true)" style="background:#d32f2f; color:#fff; padding:10px; margin-top:8px;">KH√ìA M√ÅY</button>
            <button onclick="adminToggleLock(false)" style="background:#388e3c; color:#fff; padding:10px; margin-top:8px;">M·ªû M√ÅY</button>
        </div>
        <div class="admin-section">
            <strong>L·ªánh √©p k·∫øt qu·∫£:</strong> <span id="forceStatus" style="color:cyan">T·ª∞ NHI√äN</span><br>
            <button onclick="setForce('T√†i')" style="background:#ef6c00; padding:10px; margin-top:8px;">√âP T√ÄI</button>
            <button onclick="setForce('X·ªâu')" style="background:#1565c0; padding:10px; margin-top:8px;">√âP X·ªàU</button>
            <button onclick="setForce(null)" style="background:#555; padding:10px; margin-top:8px;">H·ª¶Y L·ªÜNH</button>
        </div>
        <div class="admin-section">
            <strong>DANH S√ÅCH NG∆Ø·ªúI CH∆†I:</strong>
            <div id="userList" style="margin-top:15px; max-height: 350px; overflow-y: auto;"></div>
        </div>
    </div>
</div>

<script>
// --- C·∫§U H√åNH FIREBASE ---
const firebaseConfig = {
  apiKey: "AIzaSyCbESIH8uq5Q6R45ehisGp-Lsh9xz_ejDk",
  authDomain: "tx888-85658.firebaseapp.com",
  databaseURL: "https://tx888-85658-default-rtdb.firebaseio.com",
  projectId: "tx888-85658",
  storageBucket: "tx888-85658.firebasestorage.app",
  messagingSenderId: "246211516842",
  appId: "1:246211516842:web:24a3598d54b037676c73d3",
  measurementId: "G-0DVJPPQRDL"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let userData = null;
let selectedAmount = 0;
let selectedChoice = null;
let serverState = { isLocked: false, forcedResult: null };
const winRate = 0.2; // T·ªà L·ªÜ TH·∫ÆNG 20%

// L·∫Øng nghe d·ªØ li·ªáu Server (Realtime)
db.ref('server').on('value', (s) => { 
    serverState = s.val() || { isLocked: false, forcedResult: null }; 
    updateUI(); 
});

// ƒêƒÉng nh·∫≠p
function login() {
    const u = document.getElementById("username").value.trim().toLowerCase();
    const p = document.getElementById("password").value.trim();
    if(!u || !p) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");
    auth.signInWithEmailAndPassword(u + "@casino.com", p)
        .then(user => loadUserData(user.user.uid))
        .catch(() => alert("Sai th√¥ng tin!"));
}

// ƒêƒÉng k√Ω
function register() {
    const u = document.getElementById("username").value.trim().toLowerCase();
    const p = document.getElementById("password").value.trim();
    if(u.length < 3) return alert("T√™n ƒëƒÉng nh·∫≠p qu√° ng·∫Øn!");
    auth.createUserWithEmailAndPassword(u + "@casino.com", p).then(user => {
        db.ref('users/' + user.user.uid).set({ 
            username: u, 
            money: 2000000, 
            isAdmin: false 
        });
        alert("ƒêƒÉng k√Ω th√†nh c√¥ng!");
    }).catch(() => alert("T√™n ƒë√£ t·ªìn t·∫°i ho·∫∑c l·ªói h·ªá th·ªëng!"));
}

function logout() { auth.signOut().then(() => location.reload()); }

// T·∫£i d·ªØ li·ªáu ng∆∞·ªùi ch∆°i
function loadUserData(uid) {
    db.ref('users/' + uid).on('value', (s) => {
        userData = s.val(); if(!userData) return;
        userData.uid = uid;
        document.getElementById("loginPanel").style.display = "none";
        document.getElementById("gamePanel").style.display = "block";
        document.getElementById("displayUserName").innerText = "üë§ " + userData.username + (userData.isAdmin ? " (Admin)" : "");
        if(userData.isAdmin) {
            document.getElementById("adminPanel").style.display = "block";
            loadAllUsers();
        }
        updateUI();
    });
}

function updateUI() {
    if(!userData) return;
    document.getElementById("money").innerText = userData.money.toLocaleString() + " $";
    document.getElementById("selectedBet").innerText = `M·ª©c c∆∞·ª£c: ${selectedAmount.toLocaleString()} | C·ª≠a ch·ªçn: ${selectedChoice || "-"}`;
    
    // Disable chip n·∫øu thi·∫øu ti·ªÅn
    document.querySelectorAll(".chip").forEach(chip => {
        if(userData.money < parseInt(chip.dataset.value)) chip.classList.add("disabled");
        else chip.classList.remove("disabled");
    });

    // Tr·∫°ng th√°i server
    if(serverState.isLocked) {
        document.getElementById("lockBanner").style.display = "block";
        document.getElementById("lockStatusDisplay").innerText = "ƒêANG KH√ìA";
        document.getElementById("lockStatusDisplay").style.color = "red";
        if(!userData.isAdmin) document.getElementById("btnRoll").disabled = true;
    } else { 
        document.getElementById("lockBanner").style.display = "none"; 
        document.getElementById("lockStatusDisplay").innerText = "M·ªû";
        document.getElementById("lockStatusDisplay").style.color = "lime";
        document.getElementById("btnRoll").disabled = false; 
    }
    document.getElementById("forceStatus").innerText = serverState.forcedResult ? "√âP " + serverState.forcedResult.toUpperCase() : "T·ª∞ NHI√äN";
}

// Ch·ªçn m·ª©c c∆∞·ª£c
document.querySelectorAll(".chip").forEach(chip => {
    chip.onclick = function() {
        if(serverState.isLocked && !userData.isAdmin) return;
        selectedAmount = parseInt(this.dataset.value);
        document.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
        this.classList.add("selected");
        updateUI();
    };
});

function chooseBet(choice) { 
    if(serverState.isLocked && !userData.isAdmin) return; 
    selectedChoice = choice; 
    updateUI(); 
}

// Quay x√∫c x·∫Øc
function rollDice() {
    if(serverState.isLocked && !userData.isAdmin) return alert("M√°y ƒëang kh√≥a!");
    if(!selectedChoice || selectedAmount <= 0) return alert("Ch∆∞a ƒë·∫∑t c∆∞·ª£c!");
    if(userData.money < selectedAmount) return alert("S·ªë d∆∞ kh√¥ng ƒë·ªß!");

    let d = [r(), r(), r()], sum = d[0]+d[1]+d[2], res = sum >= 11 ? "T√†i" : "X·ªâu";

    if(serverState.forcedResult) { 
        while(res !== serverState.forcedResult) { d = [r(), r(), r()]; sum = d[0]+d[1]+d[2]; res = sum >= 11 ? "T√†i" : "X·ªâu"; } 
    } else {
        // √Åp d·ª•ng winRate 20%
        if(Math.random() > winRate) { 
            while(res === selectedChoice) { d=[r(),r(),r()]; sum=d[0]+d[1]+d[2]; res=sum>=11?"T√†i":"X·ªâu"; }
        } else {
            while(res !== selectedChoice) { d=[r(),r(),r()]; sum=d[0]+d[1]+d[2]; res=sum>=11?"T√†i":"X·ªâu"; }
        }
    }
    animate(d, sum, res);
}

function r() { return Math.floor(Math.random() * 6) + 1; }

function animate(dice, total, finalRes) {
    let count = 0;
    let t = setInterval(() => {
        document.getElementById("dice1").innerText = r(); 
        document.getElementById("dice2").innerText = r(); 
        document.getElementById("dice3").innerText = r();
        if(count++ > 15) {
            clearInterval(t);
            document.getElementById("dice1").innerText = dice[0]; 
            document.getElementById("dice2").innerText = dice[1]; 
            document.getElementById("dice3").innerText = dice[2];
            let win = (selectedChoice === finalRes);
            let newMoney = win ? userData.money + selectedAmount : userData.money - selectedAmount;
            db.ref('users/' + userData.uid).update({ money: Math.max(0, newMoney) });
            document.getElementById("resultText").innerText = `K·∫æT QU·∫¢: ${finalRes} (${total})`;
            document.getElementById("resultText").style.color = win ? "#4caf50" : "#f44336";
        }
    }, 50);
}

// ADMIN FUNCTIONS
function adminToggleLock(status) { db.ref('server').update({ isLocked: status }); }
function setForce(type) { db.ref('server').update({ forcedResult: type }); }
function loadAllUsers() {
    db.ref('users').on('value', (s) => {
        const users = s.val(); let html = "";
        for (let uid in users) {
            const u = users[uid];
            html += `<div class="user-card"><strong>${u.username}</strong> | $: ${u.money.toLocaleString()}<br>Quy·ªÅn: ${u.isAdmin ? 'Admin' : 'D√¢n'}
                    <div class="user-actions">
                        <button style="background:#2e7d32" onclick="editM('${uid}', 1000000)">+1M</button>
                        <button style="background:#c62828" onclick="editM('${uid}', -1000000)">-1M</button>
                        <button style="background:#1565c0" onclick="tAdmin('${uid}', ${u.isAdmin})">${u.isAdmin ? 'H·ªßy Admin' : 'C·∫•p Admin'}</button>
                    </div></div>`;
        }
        document.getElementById("userList").innerHTML = html;
    });
}
function editM(uid, amt) { db.ref('users/' + uid + '/money').once('value', s => db.ref('users/' + uid).update({ money: Math.max(0, s.val() + amt) })); }
function tAdmin(uid, cur) { if(uid === userData.uid) return alert("Kh√¥ng t·ª± h·ªßy quy·ªÅn m√¨nh!"); db.ref('users/' + uid).update({ isAdmin: !cur }); }
</script>
</body>
</html>
