<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino-Luxury-V47-Final-Log</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        /* T·ªîNG TH·ªÇ LUXURY - GI·ªÆ NGUY√äN V41 */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; -webkit-user-select: none; user-select: none; }
        body { background: radial-gradient(circle, #4a0000 0%, #000 100%); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow-x: hidden; height: 100vh; }
        
        /* GIAO DI·ªÜN LOGIN: S·ª¨A ƒê·ªÇ HI·ªÜN NGAY L·∫¨P T·ª®C */
        #loginPanel { 
            position: fixed; inset: 0; z-index: 9999; 
            display: flex; /* C∆∞·ª°ng ch·∫ø hi·ªán ngay khi load trang */
            align-items: center; justify-content: center; padding: 20px; 
            background: radial-gradient(circle, #4a0000 0%, #000 100%); 
        }
        .login-card { background: rgba(15, 15, 15, 0.95); padding: 40px 30px; border-radius: 30px; border: 2px solid #ffd700; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,1); }
        .login-input { width: 100%; padding: 15px; margin-bottom: 12px; border-radius: 12px; background: #111; border: 1px solid #ffd70033; color: #fff; font-size: 16px; }
        
        /* M√ÄN H√åNH CH·ªú - GI·ªÆ NGUY√äN */
        #loadingPanel { display: none; height: 100vh; align-items: center; justify-content: center; flex-direction: column; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #000; z-index: 10000; }
        .spinner { width: 40px; height: 40px; border: 4px solid #ffd70033; border-top: 4px solid #ffd700; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* GIAO DI·ªÜN GAME - GI·ªÆ NGUY√äN */
        #gamePanel { display: none; width: 100%; max-width: 500px; margin: 0 auto; padding: 15px; }
        
        /* BANNER & TH√îNG B√ÅO - GI·ªÆ NGUY√äN */
        #lockBanner { background: #b71c1c; color: #fff; padding: 12px; text-align: center; font-weight: bold; border-radius: 10px; margin-bottom: 10px; display: none; border: 2px solid #fff; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.4; } }
        .marquee-container { overflow: hidden; white-space: nowrap; padding: 8px 0; border-bottom: 1px solid rgba(255,215,0,0.1); margin-bottom: 10px; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; color: #ffd700; font-size: 13px; font-weight: bold; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* GAME UI & CHIP - GI·ªÆ NGUY√äN V41 */
        #money { font-size: 45px; color: #4caf50; font-weight: bold; text-align: center; margin: 10px 0; text-shadow: 0 0 15px rgba(76,175,80,0.6); }
        .dice { width: 70px; height: 70px; background: #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 38px; color: #000; box-shadow: 0 5px 15px #000; margin: 0 5px; }
        #chipArea { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .chip { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff; font-size: 9px; transition: 0.2s; cursor: pointer; box-shadow: 0 3px 10px #000; }
        .chip.selected { border: 3.5px solid #ffd700; transform: scale(1.15); box-shadow: 0 0 15px #ffd700; }
        .chip.disabled { opacity: 0.15; filter: grayscale(1); pointer-events: none; }
        
        .chip[data-value="1000"] { background: #4caf50; } .chip[data-value="2000"] { background: #8bc34a; } .chip[data-value="5000"] { background: #009688; }
        .chip[data-value="10000"] { background: #ff9800; } .chip[data-value="100000"] { background: #795548; } .chip[data-value="500000"] { background: #e91e63; }
        .chip[data-value="1000000"] { background: #2196f3; } .chip[data-value="2000000"] { background: #3f51b5; } .chip[data-value="5000000"] { background: #9c27b0; }
        .chip[data-value="10000000"] { background: #b71c1c; } .chip[data-value="50000000"] { background: #fbc02d; color:#000; }
        .chip[data-value="100000000"] { background: #00bcd4; } .chip[data-value="500000000"] { background: #eee; color:#000; }

        /* ADMIN PANEL - GI·ªÆ NGUY√äN V41 */
        #adminPanel { margin-top: 40px; padding: 20px; background: rgba(10, 10, 10, 0.98); border: 2px solid #ffd700; border-radius: 30px; display: none; }
        .admin-card { background: rgba(255,255,255,0.04); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,215,0,0.15); }
        .admin-title { color: #ffd700; font-size: 12px; text-transform: uppercase; margin-bottom: 12px; font-weight: bold; border-left: 4px solid #ffd700; padding-left: 10px; }
        .admin-status { font-size: 13px; margin-bottom: 10px; color: #ccc; background: #000; padding: 8px; border-radius: 8px; }
        .admin-status b { color: #ffd700; }
        .admin-btn { padding: 12px; font-size: 11px; font-weight: bold; border-radius: 8px; flex: 1; color: #fff; border: none; cursor: pointer; margin: 2px; }
        .u-input { width: 80px; background: #000; border: 1px solid #444; color: #4caf50; padding: 8px; border-radius: 6px; font-size: 12px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="loadingPanel"><div class="spinner"></div><p style="color:#ffd700; margin-top:15px; font-weight:bold;">ƒêANG B·∫¢O M·∫¨T...</p></div>

<div id="loginPanel">
    <div class="login-card">
        <h2 style="color:#ffd700; letter-spacing: 2px;">ROYAL LOGIN</h2>
        <p id="logCheckingText" style="color:#666; font-size:11px; margin-bottom:15px;">ƒêang ki·ªÉm tra Log ng·∫ßm...</p>
        <input type="text" id="username" class="login-input" placeholder="T√™n ƒëƒÉng nh·∫≠p">
        <input type="password" id="password" class="login-input" placeholder="M·∫≠t kh·∫©u">
        <button onclick="login()" style="width:100%; padding:18px; background:linear-gradient(#ffd700, #b8860b); border:none; border-radius:12px; font-weight:900; cursor:pointer; color:#000;">ƒêƒÇNG NH·∫¨P</button>
        <button onclick="register()" style="background:none; border:none; color:#888; margin-top:15px; cursor:pointer;">ƒêƒÉng k√Ω nh·∫≠n 1M$</button>
    </div>
</div>

<div id="gamePanel">
    <div id="lockBanner">‚ö†Ô∏è M√ÅY CH·ª¶ ƒêANG B·∫¢O TR√å ‚ö†Ô∏è</div>
    <div class="welcome-box"><div style="display:flex; justify-content:space-between; align-items:center;"><span id="displayWelcome">üë§ ƒêang t·∫£i...</span><button onclick="logout()" style="background:#333; color:#fff; padding:6px 12px; border-radius:10px; border:none; font-size:10px;">Tho√°t</button></div></div>
    <div id="money">0 $</div>
    <div class="marquee-container"><div id="marqueeText" class="marquee-text">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Luxury Casino!</div></div>
    <div id="historyList" style="display:flex; justify-content:center; gap:5px; margin-bottom:15px; flex-wrap:wrap;"></div>
    <div style="display:flex; justify-content:center; margin: 15px 0;"><div id="dice1" class="dice">üé≤</div><div id="dice2" class="dice">üé≤</div><div id="dice3" class="dice">üé≤</div></div>
    <div id="resultText" style="text-align:center; font-weight:bold; height: 30px; color: #ffd700;">H√¥m nay b·∫°n c∆∞·ª£c g√¨?</div>
    
    <div id="chipArea">
        <div class="chip" data-value="1000">1K</div><div class="chip" data-value="2000">2K</div><div class="chip" data-value="5000">5K</div>
        <div class="chip" data-value="10000">10K</div><div class="chip" data-value="100000">100K</div><div class="chip" data-value="500000">500K</div>
        <div class="chip" data-value="1000000">1M</div><div class="chip" data-value="2000000">2M</div><div class="chip" data-value="5000000">5M</div>
        <div class="chip" data-value="10000000">10M</div><div class="chip" data-value="50000000">50M</div><div class="chip" data-value="100000000">100M</div>
        <div class="chip" data-value="500000000">500M</div>
    </div>
    
    <div style="display:flex; justify-content: space-between;"><button onclick="chooseBet('T√†i')" style="width:48%; padding:15px; background:#ff5722; color:#fff; font-weight:bold; border-radius:10px; border:none; cursor:pointer;">T√ÄI</button><button onclick="chooseBet('X·ªâu')" style="width:48%; padding:15px; background:#2196f3; color:#fff; font-weight:bold; border-radius:10px; border:none; cursor:pointer;">X·ªàU</button></div>
    <button id="btnRoll" onclick="rollDice()" style="width:100%; padding:22px; background:linear-gradient(#ffd700, #b8860b); color:#000; font-weight:900; border-radius:15px; border:none; margin-top:10px; cursor:pointer;">QUAY TH∆Ø·ªûNG</button>

    <div id="adminPanel">
        <h2 style="color:#ffd700; text-align:center; font-size: 20px;">SUPER ADMIN CONTROL</h2>
        <div id="cardForce" class="admin-card" style="display:none;"><div class="admin-title">1. √âp k·∫øt qu·∫£ (SAD)</div><div class="admin-status">L·ªánh hi·ªán t·∫°i: <b id="forceStatusDisplay">T·ª∞ NHI√äN</b></div><div style="display:flex; gap:5px;"><button onclick="setForce('T√†i')" class="admin-btn" style="background:#e65100;">T√ÄI</button><button onclick="setForce('X·ªâu')" class="admin-btn" style="background:#0d47a1;">X·ªàU</button><button onclick="setForce(null)" class="admin-btn" style="background:#444;">H·ª¶Y</button></div></div>
        <div id="cardWinRate" class="admin-card" style="display:none;"><div class="admin-title">2. T·ªâ l·ªá th·∫Øng (%)</div><div class="admin-status">T·ªâ l·ªá hi·ªán t·∫°i: <b id="winRateDisplay">--</b>%</div><div style="display:flex; gap:10px;"><input type="number" id="inputWinRate" style="flex:1; padding:12px; background:#000; color:#fff; border:1px solid #444; border-radius:8px;"><button onclick="adminSetWinRate()" style="background:#2e7d32; color:#fff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">L∆ØU</button></div></div>
        <div id="cardServer" class="admin-card" style="display:none;"><div class="admin-title">3. M√°y ch·ªß & Th√¥ng b√°o (SAD)</div><div class="admin-status">Kh√≥a c∆∞·ª£c: <b id="lockStatusDisplay">M·ªû</b></div><div style="display:flex; gap:5px; margin-bottom:10px;"><button onclick="adminToggleLock(true)" class="admin-btn" style="background:#b71c1c;">KH√ìA M√ÅY</button><button onclick="adminToggleLock(false)" class="admin-btn" style="background:#2e7d32;">M·ªû M√ÅY</button></div><div class="admin-status">Th√¥ng b√°o hi·ªán t·∫°i: <i id="noticeStatusDisplay" style="color:#aaa;">ƒêang t·∫£i...</i></div><input type="text" id="inputNotice" placeholder="Nh·∫≠p th√¥ng b√°o m·ªõi..." style="width:100%; padding:12px; background:#000; color:#fff; border-radius:8px; border:none;"><button onclick="adminSetNotice()" class="admin-btn" style="background:#4caf50; width:100%; margin-top:5px;">C·∫¨P NH·∫¨T</button></div>
        <div id="cardUsers" class="admin-card" style="display:none;"><div class="admin-title">4. Qu·∫£n l√Ω ng∆∞·ªùi ch∆°i (SAD)</div><div id="userList"></div></div>
    </div>
</div>

<script>
// ANTI-F12 - GI·ªÆ NGUY√äN
document.onkeydown = function(e) { if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false; };

const firebaseConfig = {
  apiKey: "AIzaSyCbESIH8uq5Q6R45ehisGp-Lsh9xz_ejDk",
  authDomain: "tx888-85658.firebaseapp.com",
  databaseURL: "https://tx888-85658-default-rtdb.firebaseio.com",
  projectId: "tx888-85658",
  storageBucket: "tx888-85658.firebasestorage.app",
  messagingSenderId: "246211516842",
  appId: "1:246211516842:web:24a3598d54b037676c73d3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database(), auth = firebase.auth();
let userData = null, selectedAmount = 1000, selectedChoice = null, serverState = {}, isRolling = false;

// --- LOGIC HI·ªÇN TH·ªä M·ªöI: FIX TR·ªêNG M√ÄN H√åNH ---
auth.onAuthStateChanged((user) => {
    if (user) {
        document.getElementById("logCheckingText").innerText = "ƒê√£ t√¨m th·∫•y Log! ƒêang v√†o s√≤ng...";
        loadUserData(user.uid);
    } else {
        document.getElementById("logCheckingText").innerText = "Kh√¥ng th·∫•y Log. M·ªùi ƒëƒÉng nh·∫≠p.";
        // V·∫´n gi·ªØ nguy√™n loginPanel (v√¨ CSS m·∫∑c ƒë·ªãnh l√† flex)
        document.getElementById("gamePanel").style.display = "none";
    }
});

function loadUserData(uid) {
    db.ref('users/' + uid).on('value', (s) => {
        userData = s.val(); if(!userData) return;
        userData.uid = uid;
        
        // C∆Ø·ª†NG CH·∫æ ·∫®N LOGIN V√Ä HI·ªÜN GAME KHI C√ì D·ªÆ LI·ªÜU
        document.getElementById("loginPanel").style.display = "none";
        document.getElementById("gamePanel").style.display = "block";
        document.getElementById("displayWelcome").innerText = `üë§ Ch√†o m·ª´ng ${userData.username}`;
        
        if(userData.isAdmin || userData.isSuperAdmin) {
            document.getElementById("adminPanel").style.display = "block";
            document.getElementById("cardWinRate").style.display = "block";
            const isS = userData.isSuperAdmin ? "block" : "none";
            document.getElementById("cardForce").style.display = isS;
            document.getElementById("cardServer").style.display = isS;
            document.getElementById("cardUsers").style.display = isS;
            if(userData.isSuperAdmin) loadAllUsers();
        }
        updateUI();
    });
}

function updateUI() {
    if(!userData) return;
    document.getElementById("money").innerText = userData.money.toLocaleString() + " $";
    document.querySelectorAll(".chip").forEach(chip => {
        if (userData.money < parseInt(chip.dataset.value)) chip.classList.add("disabled");
        else chip.classList.remove("disabled");
    });
}

function login() {
    const u = document.getElementById("username").value.trim().toLowerCase(), p = document.getElementById("password").value.trim();
    if(!u || !p) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");
    auth.signInWithEmailAndPassword(u + "@casino.com", p).catch(() => alert("Sai th√¥ng tin!"));
}

async function register() {
    const u = document.getElementById("username").value.trim().toLowerCase(), p = document.getElementById("password").value.trim();
    if(u.length < 3) return alert("T√™n qu√° ng·∫Øn!");
    try {
        const res = await auth.createUserWithEmailAndPassword(u + "@casino.com", p);
        await db.ref('users/' + res.user.uid).set({ username: u, money: 1000000, isAdmin: false, isSuperAdmin: false });
        alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Nh·∫≠n 1M$");
    } catch (e) { alert("L·ªói: " + e.message); }
}

// MONITOR & TOOLS - GI·ªÆ NGUY√äN V41
db.ref('server').on('value', (s) => { 
    serverState = s.val() || { winRate: 20, isLocked: false, notice: "Ch√†o m·ª´ng!" }; 
    document.getElementById("lockBanner").style.display = serverState.isLocked ? "block" : "none";
    document.getElementById("marqueeText").innerText = serverState.notice;
    const wr = document.getElementById("winRateDisplay"); if(wr) wr.innerText = serverState.winRate;
    const fs = document.getElementById("forceStatusDisplay"); if(fs) fs.innerText = serverState.forcedResult ? "√âP " + serverState.forcedResult.toUpperCase() : "T·ª∞ NHI√äN";
    const ls = document.getElementById("lockStatusDisplay"); if(ls) ls.innerText = serverState.isLocked ? "ƒêANG KH√ìA" : "ƒêANG M·ªû";
    const ns = document.getElementById("noticeStatusDisplay"); if(ns) ns.innerText = serverState.notice;
});

db.ref('history').limitToLast(15).on('value', (s) => {
    let html = ""; const data = s.val();
    if(data) Object.values(data).forEach(item => { html += `<div style="width:20px;height:20px;border-radius:50%;background:${item.res=='T√†i'?'#ff5722':'#2196f3'};display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:bold;border:1px solid #fff;">${item.res[0]}</div>`; });
    document.getElementById("historyList").innerHTML = html;
});

function loadAllUsers() {
    db.ref('users').on('value', (s) => {
        let html = ""; const users = s.val();
        for (let uid in users) {
            const u = users[uid]; const isMe = (uid === userData.uid);
            const b = u.isSuperAdmin ? `<span style="color:#ff0000;font-size:10px;font-weight:bold;">(SAD)</span>` : (u.isAdmin ? `<span style="color:#ffff00;font-size:10px;font-weight:bold;">(AD)</span>` : `<span style="color:#888;font-size:10px;">(Member)</span>`);
            const mP = !u.isSuperAdmin ? `<button onclick="tAdmin('${uid}',${u.isAdmin})" style="background:blue;color:#fff;border:none;padding:10px;border-radius:8px;font-size:10px;">AD</button><button onclick="delU('${uid}','${u.username}')" style="background:#444;color:#fff;border:none;padding:10px;border-radius:8px;font-size:10px;">X</button>` : "";
            html += `<div class="user-item" style="background:rgba(255,255,255,0.02); padding:10px; border-radius:10px; margin-bottom:5px;"><div style="display:flex;justify-content:space-between;font-size:12px;"><b>${u.username} ${b} ${isMe?'(B·∫†N)':''}</b><span>${u.money.toLocaleString()} $</span></div>
            <div style="display:flex; gap:5px; margin-top:10px;"><input type="number" id="amt_${uid}" class="u-input" placeholder="Ti·ªÅn..."><button onclick="editM('${uid}',1)" style="background:green;color:#fff;border:none;padding:10px;border-radius:8px;">+</button><button onclick="editM('${uid}',-1)" style="background:red;color:#fff;border:none;padding:10px;border-radius:8px;">-</button>${mP}</div></div>`;
        }
        document.getElementById("userList").innerHTML = html;
    });
}

function editM(uid, type) {
    const amt = parseInt(document.getElementById("amt_" + uid).value);
    if(!amt || amt <= 0) return alert("Nh·∫≠p s·ªë!");
    db.ref('users/' + uid + '/money').once('value', s => {
        let n = (type === 1) ? s.val() + amt : s.val() - amt;
        db.ref('users/' + uid).update({ money: Math.max(0, n) });
    });
}

function adminSetWinRate() { 
    const newVal = parseInt(document.getElementById("inputWinRate").value);
    db.ref('server').update({ winRate: newVal }).then(()=>alert("ƒê√£ l∆∞u t·ªâ l·ªá th·∫Øng!")); 
}
function adminToggleLock(s) { db.ref('server').update({ isLocked: s }); }
function setForce(f) { db.ref('server').update({ forcedResult: f }); }
function adminSetNotice() { db.ref('server').update({ notice: document.getElementById("inputNotice").value }).then(()=>alert("ƒê√£ l∆∞u!")); }
function tAdmin(uid, cur) { db.ref('users/' + uid).update({ isAdmin: !cur }); }
function delU(uid, name) { if(confirm("X√≥a " + name + "?")) db.ref('users/' + uid).remove(); }
function logout() { auth.signOut().then(() => location.reload()); }
function chooseBet(c) { if(!isRolling) { selectedChoice = c; document.getElementById("resultText").innerText = "ƒê√£ ch·ªçn: " + c; } }

function rollDice() {
    if(isRolling || !selectedChoice || userData.money < selectedAmount) return alert("Ki·ªÉm tra ti·ªÅn c∆∞·ª£c!");
    if(serverState.isLocked && !userData.isSuperAdmin) return alert("H·ªÜ TH·ªêNG ƒêANG B·∫¢O TR√å!");
    isRolling = true; document.getElementById("btnRoll").disabled = true;
    userData.money -= selectedAmount; updateUI();
    db.ref('users/' + userData.uid).update({ money: userData.money });
    let d, sum, res, limit = 0;
    const curWR = (serverState.winRate !== undefined) ? serverState.winRate / 100 : 0.2;
    do {
        d = [Math.floor(Math.random()*6)+1, Math.floor(Math.random()*6)+1, Math.floor(Math.random()*6)+1];
        sum = d[0]+d[1]+d[2]; res = sum >= 11 ? "T√†i" : "X·ªâu"; limit++;
        let cond = serverState.forcedResult ? (res === serverState.forcedResult) : (Math.random() < curWR ? res === selectedChoice : res !== selectedChoice);
        if(cond || limit > 100) break;
    } while(true);
    animate(d, sum, res);
}

function animate(dice, total, finalRes) {
    let count = 0;
    let t = setInterval(() => {
        document.getElementById("dice1").innerText = Math.floor(Math.random()*6)+1;
        document.getElementById("dice2").innerText = Math.floor(Math.random()*6)+1;
        document.getElementById("dice3").innerText = Math.floor(Math.random()*6)+1;
        if(count++ > 12) {
            clearInterval(t);
            document.getElementById("dice1").innerText = dice[0]; document.getElementById("dice2").innerText = dice[1]; document.getElementById("dice3").innerText = dice[2];
            let win = (selectedChoice === finalRes);
            if(win) { userData.money += (selectedAmount * 2); db.ref('users/' + userData.uid).update({ money: userData.money }); }
            updateUI();
            document.getElementById("resultText").innerText = `K·∫æT QU·∫¢: ${finalRes} (${total})`;
            document.getElementById("resultText").style.color = win ? "#4caf50" : "#f44336";
            db.ref('history').push({ res: finalRes });
            isRolling = false; document.getElementById("btnRoll").disabled = false;
        }
    }, 60);
}
document.querySelectorAll(".chip").forEach(chip => {
    chip.onclick = function() {
        if(isRolling || this.classList.contains("disabled")) return;
        selectedAmount = parseInt(this.dataset.value);
        document.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
        this.classList.add("selected");
    };
});
</script>
</body>
</html>
